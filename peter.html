<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Peter le Traceur</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    overflow: hidden;  
    background-color: #333;
  }
  canvas {
    --grid-size: 37.8px;  
    display: block;
    background-color:#f9f9f9;
    background-image:
      linear-gradient(to right, #ddd 1px, transparent 1px),
      linear-gradient(to bottom, #ddd 1px, transparent 1px);
    background-size: var(--grid-size) var(--grid-size);
  }
</style>
</head>
<body>
<canvas id="c"></canvas>
<script>
const cmds = [
    {cmd:"Color", value:"#ff0000"},
    {cmd:"Down"},
    {cmd:"Right", value:30},
    {cmd:"Forward", value:5},
    {cmd:"Right", value:120},
    {cmd:"Forward", value:5},
    {cmd:"Right", value:120},
    {cmd:"Forward", value:5},
    {cmd:"Up"},
    {cmd:"Color", value:"#0070c0"},
    {cmd:"Down"},
    {cmd:"SetHeading", value:180},
    {cmd:"Forward", value:5},
    {cmd:"SetHeading", value:90},
    {cmd:"Forward", value:5},
    {cmd:"SetHeading", value:0},
    {cmd:"Forward", value:5},
    {cmd:"Up"},
    {cmd:"SetHeading", value:90},
    {cmd:"Forward", value:1},
    {cmd:"SetHeading", value:0},
    {cmd:"Color", value:"#ff0000"},
    {cmd:"Down"},
    {cmd:"Right", value:30},
    {cmd:"Forward", value:5},
    {cmd:"Right", value:120},
    {cmd:"Forward", value:5},
    {cmd:"Right", value:120},
    {cmd:"Forward", value:5},
    {cmd:"Up"},
    {cmd:"Color", value:"#0070c0"},
    {cmd:"Down"},
    {cmd:"SetHeading", value:180},
    {cmd:"Forward", value:5},
    {cmd:"SetHeading", value:90},
    {cmd:"Forward", value:5},
    {cmd:"SetHeading", value:0},
    {cmd:"Forward", value:5},
    {cmd:"Up"},
    {cmd:"SetHeading", value:90},
    {cmd:"Forward", value:1},
    {cmd:"SetHeading", value:0},
    {cmd:"Color", value:"#ff0000"},
    {cmd:"Down"},
    {cmd:"Right", value:30},
    {cmd:"Forward", value:5},
    {cmd:"Right", value:120},
    {cmd:"Forward", value:5},
    {cmd:"Right", value:120},
    {cmd:"Forward", value:5},
    {cmd:"Up"},
    {cmd:"Color", value:"#0070c0"},
    {cmd:"Down"},
    {cmd:"SetHeading", value:180},
    {cmd:"Forward", value:5},
    {cmd:"SetHeading", value:90},
    {cmd:"Forward", value:5},
    {cmd:"SetHeading", value:0},
    {cmd:"Forward", value:5},
    {cmd:"Up"},
    {cmd:"SetHeading", value:90},
    {cmd:"Forward", value:1},
    {cmd:"SetHeading", value:0}
];
const canvas = document.getElementById("c");
const cmToPx = 37.795; 
const ctx = canvas.getContext("2d");


canvas.width = window.innerWidth;
canvas.height = window.innerHeight;


const gridSize = parseFloat(getComputedStyle(canvas).getPropertyValue('--grid-size'));
let x = Math.round(canvas.width / 2 / gridSize) * gridSize + 0.5;
let y = Math.round(canvas.height / 2 / gridSize) * gridSize + 0.5;

let angle = -90; 
let penDown = false;
ctx.lineWidth = 2;


function drawTurtle() {
    
    ctx.save();
    ctx.translate(x, y);
    ctx.rotate(angle * Math.PI / 180);
    
    ctx.lineWidth = 2;

    ctx.beginPath();
    
    ctx.arc(0, -12, 4, 0, 2 * Math.PI);
    
    ctx.moveTo(0, -8);
    ctx.lineTo(0, 4);
    
    ctx.moveTo(-7, 0);
    ctx.lineTo(7, 0);
    
    ctx.moveTo(0, 4);
    ctx.lineTo(-5, 12);
    ctx.moveTo(0, 4);
    ctx.lineTo(5, 12);
    ctx.stroke();
    ctx.restore();
}

let i = 0;
let intervalId = null;
let speed = 100;
let path = []; 

let couleur = "black"

function step(){
    if(i >= cmds.length){
        clearInterval(intervalId);
        intervalId = null;
        redrawAll(); 
        return;
    }
    let c = cmds[i++];
    
    const oldX = x;
    const oldY = y;

    switch(c.cmd){
        case "Down": penDown = true; break;
        case "Up": penDown = false; break;
        case "Right": angle += parseFloat(c.value); break;
        case "Left": angle -= 90; break;
        case "SetHeading": angle = parseFloat(c.value) - 90; break; 
        case "Forward":
            x += c.value * cmToPx * Math.cos(angle * Math.PI / 180);
            y += c.value * cmToPx * Math.sin(angle * Math.PI / 180);
            break;
        case "Backward":
            x -= c.value * cmToPx * Math.cos(angle * Math.PI / 180);
            y -= c.value * cmToPx * Math.sin(angle * Math.PI / 180);
            break;
        case "GoTo":
            x = (canvas.width / 2) + c.value[0] * cmToPx;
            y = (canvas.height / 2) - c.value[1] * cmToPx;
            break;
        case "Color": couleur = c.value; break;
        case "PenSize": ctx.lineWidth = parseFloat(c.value); break;
        case "Circle":
            const radiusPx = c.value * cmToPx;
            
            if (penDown) {
                path.push({type: 'circle', x: x, y: y, radius: radiusPx, angle: angle, style: ctx.strokeStyle, width: ctx.lineWidth});
            }
            break;
        case "Say": setTimeout(()=>alert("Peter dit: "+c.value),50); break;
    }

    
    if (penDown && (c.cmd === "Forward" || c.cmd === "Backward" || c.cmd === "GoTo")) {
        path.push({type: 'line', x1: oldX, y1: oldY, x2: x, y2: y, style: couleur, width: ctx.lineWidth});
    }

    redrawAll();
}

function redrawAll() {
    
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    
    for (const segment of path) {
        ctx.strokeStyle = segment.style;
        ctx.lineWidth = segment.width;
        ctx.beginPath();
        if (segment.type === 'line') {
            ctx.moveTo(segment.x1, segment.y1);
            ctx.lineTo(segment.x2, segment.y2);
        } else if (segment.type === 'circle') {
            ctx.arc(segment.x + segment.radius * Math.sin(segment.angle * Math.PI / 180), segment.y - segment.radius * Math.cos(segment.angle * Math.PI / 180), segment.radius, 0, 2 * Math.PI);
        }
        ctx.stroke();
    }

    
    drawTurtle();
}

function play(){
    if(intervalId) clearInterval(intervalId);
    intervalId = setInterval(step, speed);
}


window.onresize = function() {
    location.reload();
}


play();

</script>
</body>
</html>
